#!/bin/bash
#
# Pre-commit hook that checks for uncommitted changes
# Install this hook by running: git config core.hooksPath .githooks
#

# Colors for output
RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

# Check if there are staged changes (should always be true in pre-commit)
if ! git diff --cached --quiet; then
    # There are staged changes - this is expected for a commit
    echo -e "${GREEN}âœ“ Staged changes detected, proceeding with commit...${NC}"
else
    # No staged changes - this shouldn't happen in a normal commit
    echo -e "${YELLOW}Warning: No staged changes detected${NC}"
fi

# Check for untracked files that might need to be added
UNTRACKED=$(git ls-files --others --exclude-standard)
if [ -n "$UNTRACKED" ]; then
    echo -e "${YELLOW}Warning: Untracked files detected:${NC}"
    echo "$UNTRACKED" | sed 's/^/  /'
    echo ""
    
    # Check if we're in an interactive terminal and not in CI
    if [ -t 0 ] && [ -z "$CI" ] && [ -z "$GITHUB_ACTIONS" ]; then
        read -p "Do you want to continue with the commit? (y/n) " -n 1 -r
        echo
        if [[ ! $REPLY =~ ^[Yy]$ ]]; then
            echo -e "${RED}Commit aborted${NC}"
            exit 1
        fi
    else
        echo -e "${YELLOW}Non-interactive mode: proceeding with commit${NC}"
    fi
fi

# All checks passed
exit 0
